{% extends "layouts/base.html" %}
{% block page_content %}
<div class="section-page-container">
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="{% url 'soyuz_app:get_batches' %}">all batches</a></li>
      <li class="breadcrumb-item">{{ batch.course }}</li>
      <li class="breadcrumb-item active" aria-current="page">{{ batch.number }}</li>
    </ol>
  </nav>
  <a href="{% url 'soyuz_app:get_student_list' %}">Student List</a>
  <h1>{{ batch.course }} {{ batch.number }}</h1>
  <h2>Start Date: {{ batch.start_date }}</h2>
  <p>Total number of students: {{ batch.users.count }}</p>
  <div class="section-container">
    <div class="reassign-form">
    <h4>Reassign Sections</h4>
    <label>Students per section: </label>
    <form action="/student-admin/reassign-sections" method="POST">
      {% csrf_token %}
      <input type="text" name="number_per_section">
      <input type="hidden" name="batch_id" value="{{ batch.id }}">
      <button class="btn btn-primary" type="submit" value="Submit"  onclick="return confirm('Are you sure you would like to reassign sections?');"><i class="fas fa-sync-alt"></i></button>
    </form>
    </div>
    {% for section in sections %}
    <button class="btn btn-primary" type="submit" value="Submit">Copy email addresses</button>
    <div class="section" id="section-{{section.number}}">
      <h3>Section: {{ section.number }}</h3>
      <p>Number of students: {{ section.users|length }}</p>
      <table class="table table-striped">
        <thead>
          <tr>
            <th class="first-column" scope="col">Email</th>
            <th scope="col">First Name</th>
            <th scope="col">Last Name</th>
            <th scope="col">Switch Sections</th>
            <th scope="col">Delete from Section</th>
            <th scope="col">Delete from Batch</th>
          </tr>
        </thead>
        <tbody>
          {% for user in section.users %}
          <tr>
            <th class="user-email-{{ section.number }} first-column" scope="row">{{ user.email }}</th>
            <td>{{ user.first_name }}</td>
            <td>{{ user.last_name }}</td>
            <td>
              <form action="/student-admin/switch-sections" method="POST">
                {% csrf_token %}
                <select name="section_number" class="section-select">
                  <option selected="selected" disabled>--</option>
                  {% for section in sections %}
                  <option value="{{ section.id }}">{{ section.number }}</option>
                  {% endfor %}
                </select>
                  <input type="hidden" name="user_id" value="{{ user.id }}">
                  <input type="hidden" name="batch_id" value="{{ batch.id }}">
                <button class="btn btn-primary" type="submit" value="Submit"><i class="fas fa-sync-alt"></i></button>
              </form>
            </td>
            <td>
              <form action="/student-admin/delete-from-section" method="POST">
                {% csrf_token %}
                  <input type="hidden" name="section_id" value="{{ section.id }}">
                  <input type="hidden" name="user_id" value="{{ user.id }}">
                  <input type="hidden" name="batch_id" value="{{ batch.id }}">
                <button class="btn btn-primary" type="submit"><i class="fas fa-trash-alt"></i></button>
              </form>
            </td>
            <td>
              <form action="/student-admin/delete-from-batch" method="POST">
                {% csrf_token %}
                <input type="hidden" name="section_id" value="{{ section.id }}">
                <input type="hidden" name="user_id" value="{{ user.id }}">
                <input type="hidden" name="batch_id" value="{{ batch.id }}">
                <button class="btn btn-primary" type="submit"><i class="fas fa-trash-alt"></i></button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% endfor %}
  </div>
  {% if users|length > 0 %}
  <h4>Students that don't belong in a section</h4>
  <table class="table table-striped">
    <thead>
      <tr>
        <th class="first-column" scope="col">Email</th>
        <th scope="col">First Name</th>
        <th scope="col">Last Name</th>
        <th scope="col">Add to Section</th>
      </tr>
    </thead>
    <tbody>
      {% for user in users %}
      <tr>
        <th class="first-column" scope="row">{{ user.email }}</th>
        <td>{{ user.first_name }}</td>
        <td>{{ user.last_name }}</td>
        <td>
          <form action="/student-admin/add-to-section" method="POST">
            {% csrf_token %}
            <select name="section_id" class="section-select">
              <option selected="selected" disabled>--</option>
              {% for section in sections %}
              <option value="{{ section.id }}">{{ section.number }}</option>
              {% endfor %}
            </select>
            <input type="hidden" name="user_id" value="{{ user.id }}">
            <input type="hidden" name="batch_id" value="{{ batch.id }}">
            <button class="btn btn-primary" type="submit" value="Submit"><i class="fas fa-user-plus"></i></button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% endif %}
</div>
{% endblock %}
